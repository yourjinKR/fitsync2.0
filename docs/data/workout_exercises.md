# workout_exercises

## 1. 테이블 개요 (Table Overview)
| 항목 | 내용 |
| :--- | :--- |
| **테이블 명** | `workout_exercises` |
| **설명** | `workouts`(운동 세션) 내에서 수행한 개별 운동을 기록하는 테이블입니다. 예: 벤치프레스, 스쿼트 등 |

---

## 2. 컬럼 명세 (Column Specification)
- `id`: 운동 기록 단위 고유 ID (Primary Key)  
- `workout_id`: 소속된 운동 세션의 ID (`workouts.id` 참조)  
- `exercise_id`: 운동 사전(`exercises.id`)의 참조 ID (없을 경우 `exercise_name`만 기록 가능)  
- `exercise_name`: 운동 이름 스냅샷 (원본 운동명이 변경되더라도 기록 유지 가능)  
- `memo`: 해당 운동 전체에 대한 메모 (세트 공통 메모)  

---

## 3. 관계 (Relations)
- **`workouts` (N:1)**  
  - `workout_id`를 통해 소속된 세션(`workouts.id`) 참조  
- **`exercises` (N:1, Nullable)**  
  - `exercise_id`를 통해 운동 사전(`exercises.id`) 참조  
  - 자유 운동의 경우 `exercise_id` 없이 `exercise_name`만 저장 가능  
- **`workout_sets` (1:N)**  
  - 하나의 `workout_exercises`는 여러 개의 `workout_sets`를 가질 수 있음  

---

## 4. 인덱스 (Indexes)
| 인덱스 명 | 컬럼 | 설명 |
| :--- | :--- | :--- |
| `idx_wex_workout` | `(workout_id)` | 특정 세션에 포함된 운동들을 빠르게 조회 |
| `idx_wex_workout_order` | `(workout_id, display_order)` | 세션 내 운동 순서 조회 최적화 (※ 현재 스키마에는 `display_order` 미정의 → 필요 시 컬럼 추가) |

---

## 5. DDL 쿼리문 (DDL Query)
```sql
-- 테이블이 이미 존재할 경우 삭제
DROP TABLE IF EXISTS workout_exercises CASCADE;

-- workout_exercises 테이블 생성
CREATE TABLE workout_exercises (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    workout_id BIGINT NOT NULL,

    -- 운동 식별 및 스냅샷
    exercise_id BIGINT,                     -- exercises.id (없어도 이름만으로 기록 가능)
    exercise_name VARCHAR(120),             -- 스냅샷(표시용, 이름 변경 대비)

    memo TEXT,                              -- 운동 전체 메모(세트 공통)

    CONSTRAINT fk_wex_workout  FOREIGN KEY (workout_id) REFERENCES workouts(id) ON DELETE CASCADE,
    CONSTRAINT fk_wex_exercise FOREIGN KEY (exercise_id) REFERENCES exercises(id) ON DELETE SET NULL
);

-- 세션 상세 조회/정렬
CREATE INDEX idx_wex_workout       ON workout_exercises(workout_id);
CREATE INDEX idx_wex_workout_order ON workout_exercises(workout_id, display_order);

-- 주석 추가
COMMENT ON TABLE  workout_exercises IS 'workouts(세션) 내 개별 운동 단위';
COMMENT ON COLUMN workout_exercises.exercise_name IS '운동 이름 스냅샷 (원본 이름 변경 대비)';
