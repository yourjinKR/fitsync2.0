# routines

## 1. 테이블 개요 (Table Overview)
| 항목 | 내용 |
| :--- | :--- |
| **테이블 명** | `routines` |
| **설명** | 사용자가 생성하는 운동 루틴의 목록을 관리합니다. (예: '월요일 가슴 루틴', '하체 집중') 이 테이블은 루틴의 제목과 같은 상위 정보만 담고, 상세한 운동 구성은 `routine_items` 테이블에서 정의됩니다. |

## 2. 컬럼 명세 (Column Specification)
- `id`: 루틴 고유 ID (Primary Key)
- `owner_id`: 루틴을 소유한 사용자 ID (`users.id` 참조)
- `writer_id`: 루틴을 생성한 사용자 ID (`users.id` 참조) *트레이너가 담당 회원에게 루틴을 작성하여 전달 가능*
- `name`: 루틴 이름
- `display_order`: **(추가)** 사용자가 설정하는 루틴 목록의 정렬 순서 (0부터 시작)
- `memo`: 루틴에 대한 설명
- `created_at`: 레코드 생성일시
- `updated_at`: 레코드 마지막 수정일시

## 3. 관계 (Relations)
- **`users` (N:1)**: `owner_id` 컬럼을 통해 `users` 테이블을 참조합니다.
- **`routine_items` (1:N)**: 하나의 루틴은 여러 개의 상세 운동 항목(`routine_items`)을 가질 수 있습니다.

## 4. 인덱스 (Indexes)
| 인덱스 명 | 컬럼 | 설명 |
| :--- | :--- | :--- |
| `idx_routines_user_order` | `(owner_id, display_order)` | 특정 사용자가 소유한 모든 루틴을 **정렬 순서에 맞춰** 빠르게 조회하기 위해 사용됩니다. |

## 5. DDL 쿼리문 (DDL Query)
```sql
-- 테이블이 이미 존재할 경우 삭제
DROP TABLE IF EXISTS routines CASCADE;

-- routines 테이블 생성
CREATE TABLE routines (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    owner_id BIGINT, -- 컬럼명 수정
    writer_id BIGINT, -- 작성자 컬럼 추가

    "name" VARCHAR(100) NOT NULL,
    display_order SMALLINT NOT NULL DEFAULT 0,
    memo TEXT,
    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT fk_routine_owner FOREIGN KEY(owner_id) REFERENCES users(id) ON DELETE SET NULL,
    CONSTRAINT fk_routine_writer FOREIGN KEY(writer_id) REFERENCES users(id) ON DELETE SET NULL
);

-- 인덱스 생성 (display_order를 포함하도록 수정)
CREATE INDEX idx_routines_user_order ON routines(owner_id, display_order);

-- 주석 추가
COMMENT ON TABLE routines IS '사용자가 생성하는 운동 루틴의 목록을 관리하는 테이블';
COMMENT ON COLUMN routines.owner_id IS '루틴을 소유한 사용자 ID (users.id 참조)';
COMMENT ON COLUMN routines.writer_id IS '루틴을 생성한 사용자 ID (users.id 참조)';
COMMENT ON COLUMN routines.name IS '루틴 이름 (예: 월요일 가슴 루틴)';
COMMENT ON COLUMN routines.display_order IS '사용자가 설정하는 루틴 목록의 정렬 순서 (0부터 시작)';
```