# workouts

## 1. 테이블 개요 (Table Overview)
| 항목 | 내용 |
| :--- | :--- |
| **테이블 명** | `workouts` |
| **설명** | 사용자가 실제 수행한 하루 운동 기록의 최상위 단위입니다. 루틴을 기반으로 생성될 수도 있고, 자유롭게 기록될 수도 있습니다. |

---

## 2. 컬럼 명세 (Column Specification)
- `id`: 운동 기록 고유 ID (Primary Key)  
- `owner_id`: 운동 기록을 소유한 사용자 ID (`users.id` 참조)  
- `writer_id`: 기록을 작성한 사용자 ID (`users.id` 참조) *트레이너가 회원의 기록을 대신 작성할 수도 있음*  
- `name`: 기록의 이름 (예: "2025-10-02 Chest Day")  
- `routine_snapshot`: 당시 참고한 루틴의 JSON 스냅샷 (루틴이 변경되더라도 당시 기록은 변하지 않도록 보존)  
- `title`: 운동 기록의 제목 (예: "가슴/삼두 Day")  
- `memo`: 해당 운동 세션에 대한 메모 (예: "컨디션이 안 좋아서 볼륨 줄임")  
- `created_at`: 운동 기록 생성 시각  

---

## 3. 관계 (Relations)
- **`users` (N:1)**  
  - `owner_id`를 통해 `users.id` 참조 (기록의 주인)  
  - `writer_id`를 통해 `users.id` 참조 (기록 작성자, 트레이너 가능)  

- **`workout_exercises` (1:N)**  
  - 하나의 workout은 여러 개의 `workout_exercises`를 가질 수 있음.  

---

## 4. 인덱스 (Indexes)
| 인덱스 명 | 컬럼 | 설명 |
| :--- | :--- | :--- |
| `idx_workouts_user_date` | `(owner_id, created_at DESC)` | 특정 사용자의 운동 기록을 최신순으로 빠르게 조회하기 위한 인덱스 |

---

## 5. DDL 쿼리문 (DDL Query)
```sql
-- 테이블이 이미 존재할 경우 삭제
DROP TABLE IF EXISTS workouts CASCADE;

-- workouts 테이블 생성
CREATE TABLE workouts (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    owner_id BIGINT,
    writer_id BIGINT,

    title VARCHAR(120),                    -- 예: "가슴/삼두 Day"
    routine_snapshot JSONB,                -- 당시 루틴 스냅샷(표시/회귀용)
    memo TEXT,

    -- 운동기록 인증샷도 필요할수도? attach 테이블을 활용

    created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT fk_workouts_owner FOREIGN KEY (owner_id) REFERENCES users(id) ON DELETE CASCADE,
    CONSTRAINT fk_workouts_writer FOREIGN KEY (writer_id) REFERENCES users(id) ON DELETE CASCADE
);

-- 인덱스 생성 (사용자별 최신순 조회)
CREATE INDEX idx_workouts_user_date ON workouts(owner_id, created_at DESC);

-- 주석 추가
COMMENT ON TABLE workouts IS '사용자의 하루 운동 세션(기록) 최상위 단위';
COMMENT ON COLUMN workouts.owner_id IS '운동 기록을 소유한 사용자 ID (users.id 참조)';
COMMENT ON COLUMN workouts.writer_id IS '운동 기록을 작성한 사용자 ID (users.id 참조, 트레이너 가능)';
COMMENT ON COLUMN workouts.name IS '운동 기록 이름 (예: 2025-10-02 Chest Day)';
COMMENT ON COLUMN workouts.routine_snapshot IS '기록 시점의 루틴 스냅샷(JSON)';
COMMENT ON COLUMN workouts.title IS '운동 기록 제목 (예: 가슴/삼두 Day)';
COMMENT ON COLUMN workouts.memo IS '운동 기록에 대한 메모';
COMMENT ON COLUMN workouts.created_at IS '운동 기록 생성 시각';
```
